<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>T·ª± ƒë√°nh gi√° Rubric - Nh√≥m 8 FIGHTERUS</title>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    <!-- html2pdf.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <!-- SheetJS (XLSX) - Th∆∞ vi·ªán xu·∫•t Excel M·ªöI -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* --- C√†i ƒë·∫∑t Bi·∫øn m√†u (Theme) --- */
      :root {
        /* Theme 1 (Default - Blue) */
        --color-primary: #0369a1;
        --color-primary-hover: #075985;
        --color-secondary: #0ea5e9;
        --color-secondary-hover: #0284c7;
        --color-accent: #0c4a6e;
        --color-accent-light: rgba(14, 165, 233, 0.3);
        --color-bg-light: #f0f9ff;
        --color-bg-dark: #e0f2fe;
        --color-bg-gradient: linear-gradient(
          120deg,
          #f0f9ff,
          #e0f2fe,
          #cffafe,
          #a5f3fc
        );
      }

      .theme-1 {
        /* Blue */
        --color-primary: #0369a1;
        --color-primary-hover: #075985;
        --color-secondary: #0ea5e9;
        --color-secondary-hover: #0284c7;
        --color-accent: #0c4a6e;
        --color-accent-light: rgba(14, 165, 233, 0.3);
        --color-bg-light: #f0f9ff;
        --color-bg-dark: #e0f2fe;
        --color-bg-gradient: linear-gradient(
          120deg,
          #f0f9ff,
          #e0f2fe,
          #cffafe,
          #a5f3fc
        );
      }

      .theme-2 {
        /* Pink */
        --color-primary: #d6336c;
        --color-primary-hover: #a61e4d;
        --color-secondary: #e64980;
        --color-secondary-hover: #d6336c;
        --color-accent: #a61e4d;
        --color-accent-light: rgba(214, 51, 108, 0.3);
        --color-bg-light: #fceef5;
        --color-bg-dark: #f3eafa;
        --color-bg-gradient: linear-gradient(
          120deg,
          #fceef5,
          #f3eafa,
          #fae6f2,
          #f8f0fc
        );
      }

      .theme-3 {
        /* Green */
        --color-primary: #2f9e44;
        --color-primary-hover: #2b8a3e;
        --color-secondary: #40c057;
        --color-secondary-hover: #37b24d;
        --color-accent: #2b8a3e;
        --color-accent-light: rgba(64, 192, 87, 0.3);
        --color-bg-light: #f1fcf3;
        --color-bg-dark: #e6fcf5;
        --color-bg-gradient: linear-gradient(
          120deg,
          #f1fcf3,
          #e6fcf5,
          #d3f9d8,
          #c3fae8
        );
      }

      .theme-4 {
        /* Orange */
        --color-primary: #f76707;
        --color-primary-hover: #e8590c;
        --color-secondary: #fd7e14;
        --color-secondary-hover: #f76707;
        --color-accent: #e8590c;
        --color-accent-light: rgba(253, 126, 20, 0.3);
        --color-bg-light: #fff8f0;
        --color-bg-dark: #fff4e6;
        --color-bg-gradient: linear-gradient(
          120deg,
          #fff8f0,
          #fff4e6,
          #ffe8cc,
          #ffd8a8
        );
      }

      .theme-5 {
        /* Indigo */
        --color-primary: #4c6ef5;
        --color-primary-hover: #4263eb;
        --color-secondary: #5c7cfa;
        --color-secondary-hover: #4c6ef5;
        --color-accent: #4263eb;
        --color-accent-light: rgba(76, 110, 245, 0.3);
        --color-bg-light: #f3f4ff;
        --color-bg-dark: #eef2ff;
        --color-bg-gradient: linear-gradient(
          120deg,
          #f3f4ff,
          #eef2ff,
          #dbe4ff,
          #dbe4ff
        );
      }
      /* --- End Themes --- */

      body {
        font-family: "Poppins", sans-serif;
        background: var(--color-bg-gradient);
        background-size: 400% 400%;
        animation: gradient 15s ease infinite;
        color: #333;
        text-align: center;
        margin: 0;
        padding: 20px;
        font-size: 16px;
        transition: background 0.5s ease;
      }

      @keyframes gradient {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      h1 {
        color: var(--color-accent);
        margin-top: 20px;
        text-shadow: 1px 1px 2px #fff;
        font-size: 2.5rem;
        transition: color 0.5s ease;
      }

      /* --- Form Styling --- */
      form {
        background: rgba(255, 255, 255, 0.95);
        width: 90%;
        max-width: 1000px;
        margin: 20px auto;
        padding: 30px;
        border-radius: 20px;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        overflow: hidden; /* Ch·ª©a animation */
      }

      .form-group {
        margin-bottom: 20px;
        text-align: left;
      }

      .form-group label {
        font-weight: 600;
        color: #555;
        display: block;
        margin-bottom: 8px;
      }

      input[type="text"],
      input[type="date"],
      textarea,
      select,
      input[type="number"] {
        width: 100%;
        box-sizing: border-box;
        margin: 6px 0;
        padding: 12px;
        border-radius: 10px;
        border: 1px solid #ccc;
        font-size: 1rem;
        font-family: "Poppins", sans-serif;
      }

      input[type="number"].invalid {
        border-color: #f43f5e;
        background-color: #fff1f2;
        border-width: 2px;
      }

      .date-group {
        display: flex;
        gap: 20px;
      }
      .date-group .form-group {
        flex: 1;
      }

      button {
        background-color: var(--color-primary);
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 10px;
        cursor: pointer;
        margin: 10px 5px;
        font-size: 1.1rem;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      button:hover {
        background-color: var(--color-primary-hover);
        transform: scale(1.05);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }

      #error-message {
        color: red;
        font-weight: 600;
        display: none;
        margin-top: 15px;
      }

      /* --- Wizard Styling (M·ªöI) --- */
      #info-section,
      #results-section {
        text-align: left;
      }

      .wizard-step {
        display: none; /* ·∫®n t·∫•t c·∫£ c√°c b∆∞·ªõc */
        animation: fadeIn 0.5s ease-in-out;
        text-align: left;
      }

      .wizard-step.active {
        display: block; /* Ch·ªâ hi·ªán b∆∞·ªõc active */
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      #progress-bar-container {
        width: 100%;
        background-color: #eee;
        border-radius: 10px;
        margin: 20px 0;
        overflow: hidden;
      }

      #progress-bar {
        width: 0%;
        height: 15px;
        background-color: var(--color-secondary);
        border-radius: 10px;
        transition: width 0.5s ease, background-color 0.5s ease;
        text-align: center;
        color: white;
        font-size: 12px;
        line-height: 15px;
        font-weight: 600;
      }

      .nav-btn-group {
        display: flex;
        justify-content: space-between;
        margin-top: 20px;
        border-top: 1px solid #eee;
        padding-top: 20px;
      }
      .nav-btn-group button {
        font-size: 1rem;
        padding: 10px 18px;
      }

      /* --- Skill Box Styling --- */
      .skill-box {
        background-color: var(--color-bg-light);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 15px;
        text-align: left;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        border: 1px solid var(--color-bg-dark);
        transition: background-color 0.5s ease;
      }

      .skill-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
        flex-wrap: wrap;
        gap: 10px;
      }

      .skill-title {
        font-weight: 700;
        font-size: 1.25rem;
        color: #444;
      }

      .details-btn {
        background-color: var(--color-secondary);
        color: white;
        font-size: 0.9rem;
        padding: 8px 12px;
        margin: 0;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .details-btn:hover {
        background-color: var(--color-secondary-hover);
      }

      .skill-inputs {
        display: grid;
        grid-template-columns: 1fr 3fr;
        gap: 15px;
        align-items: center;
      }

      @media (max-width: 600px) {
        .skill-inputs {
          grid-template-columns: 1fr;
        }
        .date-group {
          flex-direction: column;
          gap: 0;
        }
        .skill-header {
          flex-direction: column;
          align-items: flex-start;
        }
      }

      /* --- Rubric Link --- */
      .rubric-link {
        display: block;
        margin: 15px 0;
        color: var(--color-primary);
        font-weight: bold;
        text-decoration: none;
        font-size: 1.1rem;
      }
      .rubric-link:hover {
        text-decoration: underline;
      }

      /* --- Chart --- */
      #chart-container {
        width: 100%;
        max-width: 500px;
        margin: 20px auto;
        background: rgba(255, 255, 255, 0.8);
        padding: 15px;
        border-radius: 15px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        position: relative; /* Th√™m ƒë·ªÉ ch·ª©a ·∫£nh t·∫°m */
      }
      canvas {
        width: 100% !important;
        height: auto !important;
      }

      /* ·∫¢nh t·∫°m ƒë·ªÉ xu·∫•t PDF (M·ªöI) */
      #pdf-chart-image {
        display: none; /* ·∫®n ban ƒë·∫ßu */
        width: 100%;
        max-width: 450px;
        margin: 10px auto;
      }

      /* --- Modal Styling --- */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        padding: 20px;
        box-sizing: border-box;
      }
      .modal-content {
        background: #fff;
        padding: 30px;
        border-radius: 15px;
        width: 90%;
        max-width: 600px;
        max-height: 90vh;
        overflow-y: auto;
        position: relative;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }
      .modal-close {
        position: absolute;
        top: 15px;
        right: 20px;
        font-size: 2.5rem;
        font-weight: bold;
        cursor: pointer;
        color: #aaa;
        line-height: 1;
      }
      .modal-close:hover {
        color: #333;
      }
      .modal-content h2 {
        margin-top: 0;
        color: var(--color-primary);
      }
      .modal-content ul {
        list-style: none;
        padding-left: 0;
        text-align: left;
      }
      .modal-content li {
        background: #f9f9f9;
        margin-bottom: 10px;
        padding: 15px;
        border-radius: 8px;
        border-left: 5px solid var(--color-secondary);
      }
      .modal-content li strong {
        color: var(--color-accent);
        font-size: 1.1rem;
      }

      /* --- PDF Export & Report Styling (ƒê√É C·∫¨P NH·∫¨T) --- */
      #report-content {
        /* (ƒê√É X√ìA) G·ª° b·ªè style A4 c·ªë ƒë·ªãnh */
        /*
      width: 720px;
      margin: 30px auto;
      padding: 40px;
      border: 1px solid #ddd;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      */

        /* (M·ªöI) Tr·ªü l·∫°i layout co gi√£n 100% */
        width: 100%;
        margin: 0;
        padding: 15px; /* Gi·∫£m padding ƒë·ªÉ v·ª´a A4 */
        background: #fff; /* Gi·ªØ l·∫°i n·ªÅn tr·∫Øng */
        border-radius: 15px; /* (M·ªöI) Th√™m bo g√≥c cho h·ª£p layout */

        box-sizing: border-box;

        /* ƒê√¢y l√† n·ªôi dung s·∫Ω ƒë∆∞·ª£c xu·∫•t PDF */
        text-align: left;
        
        /* T·ªëi ∆∞u render cho PDF - l√†m ch·ªØ s·∫Øc n√©t h∆°n */
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        text-rendering: optimizeLegibility;
      }

      /* (M·ªöI) G·ª° b·ªè media query cho A4 */
      @media (max-width: 800px) {
        #report-content {
          width: 100%;
          margin: 0; /* (ƒê√É S·ª¨A) */
          padding: 15px; /* (ƒê√É S·ª¨A) */
          border: none;
          box-shadow: none;
        }
      }

      /* (ƒê√É X√ìA) G·ª° b·ªè class helper .pdf-generating */
      /*
    .pdf-generating #report-content {
      width: 100% !important;
      margin: 0 !important;
      padding: 0 !important;
      border: none !important;
      box-shadow: none !important;
    }
    .pdf-generating .nav-btn-group {
      display: none !important; 
    }
    */

      .pdf-header {
        text-align: center;
        border-bottom: 2px solid var(--color-accent);
        padding-bottom: 8px;
        margin-bottom: 15px;
      }
      .pdf-header h1 {
        color: var(--color-accent);
        margin: 0;
        font-size: 20pt;
        text-align: center;
      }
      .pdf-header h3 {
        color: var(--color-primary);
        margin: 3px 0 0 0;
        font-size: 14pt;
        font-weight: 600;
        text-align: center;
      }
      .pdf-info {
        margin-bottom: 15px;
        font-size: 11pt;
      }
      .pdf-info p {
        margin: 5px 0;
        color: #333;
        text-align: left;
      }
      .pdf-info span {
        font-weight: 400;
      }
      .pdf-info strong {
        color: var(--color-primary-hover);
        width: 150px;
        display: inline-block;
        font-weight: 600;
      }
      .pdf-chart-container {
        text-align: center;
        margin-top: 15px;
        margin-bottom: 10px;
        page-break-inside: avoid; /* (M·ªöI) NgƒÉn chart b·ªã ng·∫Øt */
        page-break-after: auto; /* (M·ªöI) Cho ph√©p ng·∫Øt trang sau m·ª•c n√†y n·∫øu c·∫ßn */
      }
      .pdf-chart-container h2 {
        color: var(--color-accent);
        text-align: center;
        font-size: 14pt;
        border-bottom: 1px solid #eee;
        padding-bottom: 6px;
        margin-bottom: 10px;
      }
      .pdf-chart-container img {
        display: block;
        margin: 10px auto;
        width: 100%;
        max-width: 450px;
      }

      /* B·∫£ng ƒëi·ªÉm chi ti·∫øt (M·ªöI) */
      .pdf-table-container {
        margin-top: 15px;
        page-break-inside: avoid; /* (M·ªöI) NgƒÉn b·∫£ng (v√† ti√™u ƒë·ªÅ) b·ªã ng·∫Øt */
        page-break-after: auto; /* (M·ªöI) Cho ph√©p ng·∫Øt trang sau m·ª•c n√†y n·∫øu c·∫ßn */
      }
      .pdf-table-container h2 {
        color: var(--color-accent);
        font-size: 14pt;
        text-align: left;
        border-bottom: 1px solid #eee;
        padding-bottom: 6px;
        margin-bottom: 10px;
      }
      .report-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 9pt;
      }
      .report-table th,
      .report-table td {
        border: 1px solid #ddd;
        padding: 6px;
        text-align: left;
        word-break: break-word;
      }
      .report-table th {
        background-color: var(--color-bg-light);
        color: var(--color-accent);
        font-weight: 600;
      }
      .report-table tr:nth-child(even) {
        background-color: #f9f9f9;
      }
      .report-table td:nth-child(1) {
        width: 30%;
      } /* K·ªπ nƒÉng */
      .report-table td:nth-child(2) {
        width: 10%;
        text-align: center;
      } /* ƒêi·ªÉm */
      .report-table td:nth-child(3) {
        width: 60%;
      } /* Nh·∫≠n x√©t */

      /* Nh·∫≠n x√©t t·ªïng quan (M·ªöI) */
      .pdf-comment {
        margin-top: 15px;
        page-break-inside: avoid; /* (M·ªöI) NgƒÉn m·ª•c n√†y b·ªã ng·∫Øt */
      }
      .pdf-comment h2 {
        color: var(--color-accent);
        font-size: 14pt;
        text-align: left;
        border-bottom: 1px solid #eee;
        padding-bottom: 6px;
        margin-bottom: 10px;
      }
      .pdf-comment p {
        font-size: 10pt;
        color: #333;
        white-space: pre-wrap;
        text-align: left;
        background: var(--color-bg-light);
        padding: 10px;
        border-radius: 8px;
        border: 1px solid var(--color-bg-dark);
        line-height: 1.4;
      }
    </style>
  </head>
  <body class="theme-1">
    <!-- S·ª¨A L·ªñI 1: B·ªè 1 emoji hoa -->
    <h1>üå∏[NH√ìM 8 -FIGHTERUS] B·∫¢NG ƒê√ÅNH GI√Å NƒÇNG L·ª∞C RUBRICüå∏</h1>

    <form id="rubricForm" onsubmit="return false;">
      <!-- B∆Ø·ªöC 1: TH√îNG TIN CHUNG -->
      <div id="info-section" class="wizard-step" data-step="0">
        <!-- X√≥a class 'active' ban ƒë·∫ßu, JS s·∫Ω x·ª≠ l√Ω -->
        <h2>Th√¥ng tin chung</h2>
        <div class="form-group">
          <label for="groupName">T√™n nh√≥m:</label>
          <input
            type="text"
            id="groupName"
            value="Nh√≥m 8 FIGHTERUS"
            required
            placeholder="Nh·∫≠p t√™n nh√≥m..."
          />
        </div>

        <!-- CH·ªåN TH√ÄNH VI√äN (M·ªöI) -->
        <div class="form-group">
          <label for="member-select">Ch·ªçn th√†nh vi√™n:</label>
          <select id="member-select" required>
            <option value="" disabled selected>-- Ch·ªçn t√™n c·ªßa b·∫°n --</option>
            <option value="1">Tr·∫ßn Nh∆∞ Tri</option>
            <option value="2">Tr·∫ßn VƒÉn Lƒ©nh</option>
            <option value="3">Nguy·ªÖn Ki·ªÅu Xu√¢n H·∫≠u</option>
            <option value="4">Ph·∫°m Vi·ªát Th√πy Trinh</option>
            <option value="5">Nguy·ªÖn Th·ªã H·∫±ng</option>
          </select>
        </div>

        <div class="date-group">
          <div class="form-group">
            <label for="week-start">Tu·∫ßn - T·ª´ ng√†y:</label>
            <input type="date" id="week-start" required />
          </div>
          <div class="form-group">
            <label for="week-end">ƒê·∫øn ng√†y:</label>
            <input type="date" id="week-end" required />
          </div>
        </div>

        <a
          class="rubric-link"
          href="https://docs.google.com/spreadsheets/d/1kSebXE_SGICsDeqpJi9hobELXeOFB7Ge/edit?usp=drive_link&ouid=113084211751693299817&rtpof=true&sd=true"
          target="_blank"
        >
          üìò Xem file Rubric chu·∫©n t·∫°i ƒë√¢y
        </a>
                <a
          class="rubric-link"
          href="https://docs.google.com/spreadsheets/d/1yPNAyHXGdahAjn9qH4mDD1urx0DNnqX2/edit?usp=drive_link&ouid=113084211751693299817&rtpof=true&sd=true"
          target="_blank"
        >
          üßæ Ti·∫øn ƒë·ªô d·ª± √°n (OPPM)
        </a>

        <p id="error-message-step0" style="color: red; display: none">
          Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin chung.
        </p>

        <div class="nav-btn-group">
          <span></span>
          <!-- Placeholder for alignment -->
          <button type="button" onclick="nextStep(0)">B·∫Øt ƒë·∫ßu ‚û°Ô∏è</button>
        </div>
      </div>

      <!-- THANH TI·∫æN TR√åNH (M·ªöI) -->
      <div id="progress-bar-container" style="display: none">
        <div id="progress-bar">0%</div>
      </div>

      <!-- C√ÅC B∆Ø·ªöC ƒê√ÅNH GI√Å (WIZARD) -->
      <div id="wizard-container" style="display: none">
        <!-- 1. L√†m vi·ªác nh√≥m -->
        <div class="skill-box wizard-step" data-step="1">
          <div class="skill-header">
            <div class="skill-title">1Ô∏è‚É£ L√†m vi·ªác nh√≥m (Team Work)</div>
            <button
              type="button"
              class="details-btn"
              onclick="showModal(1, 'L√†m vi·ªác nh√≥m')"
            >
              Xem chi ti·∫øt
            </button>
          </div>
          <div class="skill-inputs">
            <input
              type="number"
              min="0"
              max="3"
              id="s1"
              placeholder="ƒêi·ªÉm (0-3)..."
              required
              oninput="validateScore(this)"
            />
            <textarea
              id="c1"
              rows="2"
              placeholder="T·ª± nh·∫≠n x√©t..."
              required
            ></textarea>
          </div>
          <p
            id="error-message-step1"
            class="step-error"
            style="color: red; display: none"
          >
            Vui l√≤ng ƒëi·ªÅn ƒëi·ªÉm (0-3) v√† nh·∫≠n x√©t.
          </p>
          <div class="nav-btn-group">
            <button type="button" onclick="prevStep()">‚¨ÖÔ∏è Quay l·∫°i</button>
            <button type="button" onclick="nextStep(1)">Ti·∫øp theo ‚û°Ô∏è</button>
          </div>
        </div>

        <!-- 2. Qu·∫£n l√Ω th·ªùi gian -->
        <div class="skill-box wizard-step" data-step="2">
          <div class="skill-header">
            <div class="skill-title">2Ô∏è‚É£ Qu·∫£n l√Ω th·ªùi gian (Planning)</div>
            <button
              type="button"
              class="details-btn"
              onclick="showModal(2, 'Qu·∫£n l√Ω th·ªùi gian')"
            >
              Xem chi ti·∫øt
            </button>
          </div>
          <div class="skill-inputs">
            <input
              type="number"
              min="0"
              max="3"
              id="s2"
              placeholder="ƒêi·ªÉm (0-3)..."
              required
              oninput="validateScore(this)"
            />
            <textarea
              id="c2"
              rows="2"
              placeholder="T·ª± nh·∫≠n x√©t..."
              required
            ></textarea>
          </div>
          <p
            id="error-message-step2"
            class="step-error"
            style="color: red; display: none"
          >
            Vui l√≤ng ƒëi·ªÅn ƒëi·ªÉm (0-3) v√† nh·∫≠n x√©t.
          </p>
          <div class="nav-btn-group">
            <button type="button" onclick="prevStep()">‚¨ÖÔ∏è Quay l·∫°i</button>
            <button type="button" onclick="nextStep(2)">Ti·∫øp theo ‚û°Ô∏è</button>
          </div>
        </div>

        <!-- 3. Tr√°ch nhi·ªám & h·ªó tr·ª£ -->
        <div class="skill-box wizard-step" data-step="3">
          <div class="skill-header">
            <div class="skill-title">3Ô∏è‚É£ Tr√°ch nhi·ªám & h·ªó tr·ª£ (Project Mgt)</div>
            <button
              type="button"
              class="details-btn"
              onclick="showModal(3, 'Tr√°ch nhi·ªám & h·ªó tr·ª£')"
            >
              Xem chi ti·∫øt
            </button>
          </div>
          <div class="skill-inputs">
            <input
              type="number"
              min="0"
              max="3"
              id="s3"
              placeholder="ƒêi·ªÉm (0-3)..."
              required
              oninput="validateScore(this)"
            />
            <textarea
              id="c3"
              rows="2"
              placeholder="T·ª± nh·∫≠n x√©t..."
              required
            ></textarea>
          </div>
          <p
            id="error-message-step3"
            class="step-error"
            style="color: red; display: none"
          >
            Vui l√≤ng ƒëi·ªÅn ƒëi·ªÉm (0-3) v√† nh·∫≠n x√©t.
          </p>
          <div class="nav-btn-group">
            <button type="button" onclick="prevStep()">‚¨ÖÔ∏è Quay l·∫°i</button>
            <button type="button" onclick="nextStep(3)">Ti·∫øp theo ‚û°Ô∏è</button>
          </div>
        </div>

        <!-- 4. Gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ -->
        <div class="skill-box wizard-step" data-step="4">
          <div class="skill-header">
            <div class="skill-title">
              4Ô∏è‚É£ Gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ (Problem Solving)
            </div>
            <button
              type="button"
              class="details-btn"
              onclick="showModal(4, 'Gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ')"
            >
              Xem chi ti·∫øt
            </button>
          </div>
          <div class="skill-inputs">
            <input
              type="number"
              min="0"
              max="3"
              id="s4"
              placeholder="ƒêi·ªÉm (0-3)..."
              required
              oninput="validateScore(this)"
            />
            <textarea
              id="c4"
              rows="2"
              placeholder="T·ª± nh·∫≠n x√©t..."
              required
            ></textarea>
          </div>
          <p
            id="error-message-step4"
            class="step-error"
            style="color: red; display: none"
          >
            Vui l√≤ng ƒëi·ªÅn ƒëi·ªÉm (0-3) v√† nh·∫≠n x√©t.
          </p>
          <div class="nav-btn-group">
            <button type="button" onclick="prevStep()">‚¨ÖÔ∏è Quay l·∫°i</button>
            <button type="button" onclick="nextStep(4)">Ti·∫øp theo ‚û°Ô∏è</button>
          </div>
        </div>

        <!-- 5. Giao ti·∫øp & th·∫•u hi·ªÉu -->
        <div class="skill-box wizard-step" data-step="5">
          <div class="skill-header">
            <div class="skill-title">
              5Ô∏è‚É£ Giao ti·∫øp & th·∫•u hi·ªÉu (Interpersonal)
            </div>
            <button
              type="button"
              class="details-btn"
              onclick="showModal(5, 'Giao ti·∫øp & th·∫•u hi·ªÉu')"
            >
              Xem chi ti·∫øt
            </button>
          </div>
          <div class="skill-inputs">
            <input
              type="number"
              min="0"
              max="3"
              id="s5"
              placeholder="ƒêi·ªÉm (0-3)..."
              required
              oninput="validateScore(this)"
            />
            <textarea
              id="c5"
              rows="2"
              placeholder="T·ª± nh·∫≠n x√©t..."
              required
            ></textarea>
          </div>
          <p
            id="error-message-step5"
            class="step-error"
            style="color: red; display: none"
          >
            Vui l√≤ng ƒëi·ªÅn ƒëi·ªÉm (0-3) v√† nh·∫≠n x√©t.
          </p>
          <div class="nav-btn-group">
            <button type="button" onclick="prevStep()">‚¨ÖÔ∏è Quay l·∫°i</button>
            <button type="button" onclick="nextStep(5)">Ti·∫øp theo ‚û°Ô∏è</button>
          </div>
        </div>

        <!-- 6. ·ª®ng ph√≥ kh·ªßng ho·∫£ng -->
        <div class="skill-box wizard-step" data-step="6">
          <div class="skill-header">
            <div class="skill-title">
              6Ô∏è‚É£ ·ª®ng ph√≥ kh·ªßng ho·∫£ng (Crisis Solving)
            </div>
            <button
              type="button"
              class="details-btn"
              onclick="showModal(6, '·ª®ng ph√≥ kh·ªßng ho·∫£ng')"
            >
              Xem chi ti·∫øt
            </button>
          </div>
          <div class="skill-inputs">
            <input
              type="number"
              min="0"
              max="3"
              id="s6"
              placeholder="ƒêi·ªÉm (0-3)..."
              required
              oninput="validateScore(this)"
            />
            <textarea
              id="c6"
              rows="2"
              placeholder="T·ª± nh·∫≠n x√©t..."
              required
            ></textarea>
          </div>
          <p
            id="error-message-step6"
            class="step-error"
            style="color: red; display: none"
          >
            Vui l√≤ng ƒëi·ªÅn ƒëi·ªÉm (0-3) v√† nh·∫≠n x√©t.
          </p>
          <div class="nav-btn-group">
            <button type="button" onclick="prevStep()">‚¨ÖÔ∏è Quay l·∫°i</button>
            <button type="button" onclick="nextStep(6)">Ti·∫øp theo ‚û°Ô∏è</button>
          </div>
        </div>

        <!-- 7. Gi·∫£i quy·∫øt xung ƒë·ªôt -->
        <div class="skill-box wizard-step" data-step="7">
          <div class="skill-header">
            <div class="skill-title">
              7Ô∏è‚É£ Gi·∫£i quy·∫øt xung ƒë·ªôt (Conflict Resolution)
            </div>
            <button
              type="button"
              class="details-btn"
              onclick="showModal(7, 'Gi·∫£i quy·∫øt xung ƒë·ªôt')"
            >
              Xem chi ti·∫øt
            </button>
          </div>
          <div class="skill-inputs">
            <input
              type="number"
              min="0"
              max="3"
              id="s7"
              placeholder="ƒêi·ªÉm (0-3)..."
              required
              oninput="validateScore(this)"
            />
            <textarea
              id="c7"
              rows="2"
              placeholder="T·ª± nh·∫≠n x√©t..."
              required
            ></textarea>
          </div>
          <p
            id="error-message-step7"
            class="step-error"
            style="color: red; display: none"
          >
            Vui l√≤ng ƒëi·ªÅn ƒëi·ªÉm (0-3) v√† nh·∫≠n x√©t.
          </p>
          <div class="nav-btn-group">
            <button type="button" onclick="prevStep()">‚¨ÖÔ∏è Quay l·∫°i</button>
            <button type="button" onclick="nextStep(7)">Ti·∫øp theo ‚û°Ô∏è</button>
          </div>
        </div>

        <!-- 8. Vi·∫øt -->
        <div class="skill-box wizard-step" data-step="8">
          <div class="skill-header">
            <div class="skill-title">8Ô∏è‚É£ Vi·∫øt (Writing)</div>
            <button
              type="button"
              class="details-btn"
              onclick="showModal(8, 'Vi·∫øt')"
            >
              Xem chi ti·∫øt
            </button>
          </div>
          <div class="skill-inputs">
            <input
              type="number"
              min="0"
              max="3"
              id="s8"
              placeholder="ƒêi·ªÉm (0-3)..."
              required
              oninput="validateScore(this)"
            />
            <textarea
              id="c8"
              rows="2"
              placeholder="T·ª± nh·∫≠n x√©t..."
              required
            ></textarea>
          </div>
          <p
            id="error-message-step8"
            class="step-error"
            style="color: red; display: none"
          >
            Vui l√≤ng ƒëi·ªÅn ƒëi·ªÉm (0-3) v√† nh·∫≠n x√©t.
          </p>
          <div class="nav-btn-group">
            <button type="button" onclick="prevStep()">‚¨ÖÔ∏è Quay l·∫°i</button>
            <button type="button" onclick="nextStep(8)">Ti·∫øp theo ‚û°Ô∏è</button>
          </div>
        </div>

        <!-- 9. L·∫Øng nghe -->
        <div class="skill-box wizard-step" data-step="9">
          <div class="skill-header">
            <div class="skill-title">9Ô∏è‚É£ L·∫Øng nghe (Listening)</div>
            <button
              type="button"
              class="details-btn"
              onclick="showModal(9, 'L·∫Øng nghe')"
            >
              Xem chi ti·∫øt
            </button>
          </div>
          <div class="skill-inputs">
            <input
              type="number"
              min="0"
              max="3"
              id="s9"
              placeholder="ƒêi·ªÉm (0-3)..."
              required
              oninput="validateScore(this)"
            />
            <textarea
              id="c9"
              rows="2"
              placeholder="T·ª± nh·∫≠n x√©t..."
              required
            ></textarea>
          </div>
          <p
            id="error-message-step9"
            class="step-error"
            style="color: red; display: none"
          >
            Vui l√≤ng ƒëi·ªÅn ƒëi·ªÉm (0-3) v√† nh·∫≠n x√©t.
          </p>
          <div class="nav-btn-group">
            <button type="button" onclick="prevStep()">‚¨ÖÔ∏è Quay l·∫°i</button>
            <button type="button" onclick="nextStep(9)">Ti·∫øp theo ‚û°Ô∏è</button>
          </div>
        </div>

        <!-- 10. T·ª± h·ªçc -->
        <div class="skill-box wizard-step" data-step="10">
          <div class="skill-header">
            <div class="skill-title">üîü T·ª± h·ªçc (Learning)</div>
            <button
              type="button"
              class="details-btn"
              onclick="showModal(10, 'T·ª± h·ªçc')"
            >
              Xem chi ti·∫øt
            </button>
          </div>
          <div class="skill-inputs">
            <input
              type="number"
              min="0"
              max="3"
              id="s10"
              placeholder="ƒêi·ªÉm (0-3)..."
              required
              oninput="validateScore(this)"
            />
            <textarea
              id="c10"
              rows="2"
              placeholder="T·ª± nh·∫≠n x√©t..."
              required
            ></textarea>
          </div>
          <p
            id="error-message-step10"
            class="step-error"
            style="color: red; display: none"
          >
            Vui l√≤ng ƒëi·ªÅn ƒëi·ªÉm (0-3) v√† nh·∫≠n x√©t.
          </p>
          <div class="nav-btn-group">
            <button type="button" onclick="prevStep()">‚¨ÖÔ∏è Quay l·∫°i</button>
            <button type="button" onclick="nextStep(10)">Ti·∫øp theo ‚û°Ô∏è</button>
          </div>
        </div>

        <!-- 11. Thuy·∫øt tr√¨nh -->
        <div class="skill-box wizard-step" data-step="11">
          <div class="skill-header">
            <div class="skill-title">1Ô∏è‚É£1Ô∏è‚É£ Thuy·∫øt tr√¨nh (Presentation)</div>
            <button
              type="button"
              class="details-btn"
              onclick="showModal(11, 'Thuy·∫øt tr√¨nh')"
            >
              Xem chi ti·∫øt
            </button>
          </div>
          <div class="skill-inputs">
            <input
              type="number"
              min="0"
              max="3"
              id="s11"
              placeholder="ƒêi·ªÉm (0-3)..."
              required
              oninput="validateScore(this)"
            />
            <textarea
              id="c11"
              rows="2"
              placeholder="T·ª± nh·∫≠n x√©t..."
              required
            ></textarea>
          </div>
          <p
            id="error-message-step11"
            class="step-error"
            style="color: red; display: none"
          >
            Vui l√≤ng ƒëi·ªÅn ƒëi·ªÉm (0-3) v√† nh·∫≠n x√©t.
          </p>
          <div class="nav-btn-group">
            <button type="button" onclick="prevStep()">‚¨ÖÔ∏è Quay l·∫°i</button>
            <button type="button" onclick="nextStep(11)">Ti·∫øp theo ‚û°Ô∏è</button>
          </div>
        </div>

        <!-- 12. T∆∞∆°ng t√°c nh√≥m Online -->
        <div class="skill-box wizard-step" data-step="12">
          <div class="skill-header">
            <div class="skill-title">
              1Ô∏è‚É£2Ô∏è‚É£ T∆∞∆°ng t√°c nh√≥m Online (Group Online)
            </div>
            <button
              type="button"
              class="details-btn"
              onclick="showModal(12, 'T∆∞∆°ng t√°c nh√≥m Online')"
            >
              Xem chi ti·∫øt
            </button>
          </div>
          <div class="skill-inputs">
            <input
              type="number"
              min="0"
              max="3"
              id="s12"
              placeholder="ƒêi·ªÉm (0-3)..."
              required
              oninput="validateScore(this)"
            />
            <textarea
              id="c12"
              rows="2"
              placeholder="T·ª± nh·∫≠n x√©t..."
              required
            ></textarea>
          </div>
          <p
            id="error-message-step12"
            class="step-error"
            style="color: red; display: none"
          >
            Vui l√≤ng ƒëi·ªÅn ƒëi·ªÉm (0-3) v√† nh·∫≠n x√©t.
          </p>
          <div class="nav-btn-group">
            <button type="button" onclick="prevStep()">‚¨ÖÔ∏è Quay l·∫°i</button>
            <button type="button" onclick="nextStep(12)">Ti·∫øp theo ‚û°Ô∏è</button>
          </div>
        </div>

        <!-- 13. Chuy√™n c·∫ßn -->
        <div class="skill-box wizard-step" data-step="13">
          <div class="skill-header">
            <div class="skill-title">1Ô∏è‚É£3Ô∏è‚É£ Chuy√™n c·∫ßn (Attendance)</div>
            <!-- S·ª¨A L·ªñI 2: X√≥a class_= -->
            <button
              type="button"
              class="details-btn"
              onclick="showModal(13, 'Chuy√™n c·∫ßn')"
            >
              Xem chi ti·∫øt
            </button>
          </div>
          <div class="skill-inputs">
            <input
              type="number"
              min="0"
              max="3"
              id="s13"
              placeholder="ƒêi·ªÉm (0-3)..."
              required
              oninput="validateScore(this)"
            />
            <textarea
              id="c13"
              rows="2"
              placeholder="T·ª± nh·∫≠n x√©t..."
              required
            ></textarea>
          </div>
          <p
            id="error-message-step13"
            class="step-error"
            style="color: red; display: none"
          >
            Vui l√≤ng ƒëi·ªÅn ƒëi·ªÉm (0-3) v√† nh·∫≠n x√©t.
          </p>
          <div class="nav-btn-group">
            <button type="button" onclick="prevStep()">‚¨ÖÔ∏è Quay l·∫°i</button>
            <button type="button" onclick="nextStep(13)">Ti·∫øp theo ‚û°Ô∏è</button>
          </div>
        </div>

        <!-- 14. L√£nh ƒë·∫°o -->
        <div class="skill-box wizard-step" data-step="14">
          <div class="skill-header">
            <div class="skill-title">1Ô∏è‚É£4Ô∏è‚É£ L√£nh ƒë·∫°o (Leadership)</div>
            <button
              type="button"
              class="details-btn"
              onclick="showModal(14, 'L√£nh ƒë·∫°o')"
            >
              Xem chi ti·∫øt
            </button>
          </div>
          <div class="skill-inputs">
            <input
              type="number"
              min="0"
              max="3"
              id="s14"
              placeholder="ƒêi·ªÉm (0-3)..."
              required
              oninput="validateScore(this)"
            />
            <textarea
              id="c14"
              rows="2"
              placeholder="T·ª± nh·∫≠n x√©t..."
              required
            ></textarea>
          </div>
          <p
            id="error-message-step14"
            class="step-error"
            style="color: red; display: none"
          >
            Vui l√≤ng ƒëi·ªÅn ƒëi·ªÉm (0-3) v√† nh·∫≠n x√©t.
          </p>
          <div class="nav-btn-group">
            <button type="button" onclick="prevStep()">‚¨ÖÔ∏è Quay l·∫°i</button>
            <button type="button" onclick="nextStep(14)">Ti·∫øp theo ‚û°Ô∏è</button>
          </div>
        </div>

        <!-- 15. Nh·∫≠n x√©t t·ªïng quan -->
        <div class="skill-box wizard-step" data-step="15">
          <div class="skill-header">
            <div class="skill-title">1Ô∏è‚É£5Ô∏è‚É£ Nh·∫≠n x√©t t·ªïng quan</div>
          </div>
          <div class="form-group" style="margin-top: 20px">
            <label for="comment">T·ªïng k·∫øt tu·∫ßn n√†y c·ªßa b·∫°n:</label>
            <textarea
              id="comment"
              rows="6"
              placeholder="T·ªïng k·∫øt tu·∫ßn n√†y c·ªßa b·∫°n..."
              required
            ></textarea>
          </div>
          <p
            id="error-message-step15"
            class="step-error"
            style="color: red; display: none"
          >
            Vui l√≤ng ƒëi·ªÅn nh·∫≠n x√©t t·ªïng quan.
          </p>
          <div class="nav-btn-group">
            <button type="button" onclick="prevStep()">‚¨ÖÔ∏è Quay l·∫°i</button>
            <button type="button" onclick="finishForm()">
              üéâ Ho√†n th√†nh & Xem k·∫øt qu·∫£
            </button>
          </div>
        </div>
      </div>

      <!-- B∆Ø·ªöC CU·ªêI: K·∫æT QU·∫¢ (ƒê√É C·∫¨P NH·∫¨T) -->
      <div id="results-section" style="display: none">
        <!-- N·ªôi dung b√°o c√°o ƒë·ªÉ xu·∫•t PDF -->
        <div id="report-content">
          <div class="pdf-header">
            <h1>B√ÅO C√ÅO T·ª∞ ƒê√ÅNH GI√Å RUBRIC</h1>
            <h3 id="report-groupName"></h3>
          </div>

          <div class="pdf-info">
            <p><strong>Th√†nh vi√™n:</strong> <span id="report-name"></span></p>
            <p>
              <strong>Tu·∫ßn l√†m vi·ªác:</strong> <span id="report-week"></span>
            </p>
          </div>

          <div class="pdf-chart-container">
            <h2>Bi·ªÉu ƒë·ªì nƒÉng l·ª±c Radar</h2>
            <div id="chart-container" style="max-width: 450px; padding: 10px;">
              <canvas id="radarChart"></canvas>
              <!-- ·∫¢nh t·∫°m ƒë·ªÉ xu·∫•t PDF (M·ªöI) -->
              <img id="pdf-chart-image" src="" alt="Bi·ªÉu ƒë·ªì Rubric" />
            </div>
          </div>

          <!-- B·∫£ng ƒëi·ªÉm chi ti·∫øt (M·ªöI) -->
          <div class="pdf-table-container">
            <h2>B·∫£ng ƒëi·ªÉm chi ti·∫øt</h2>
            <table class="report-table">
              <thead>
                <tr>
                  <th>K·ªπ nƒÉng</th>
                  <th>ƒêi·ªÉm</th>
                  <th>Nh·∫≠n x√©t</th>
                </tr>
              </thead>
              <tbody id="report-table-body">
                <!-- JS s·∫Ω ƒëi·ªÅn v√†o ƒë√¢y -->
              </tbody>
            </table>
          </div>

          <!-- Nh·∫≠n x√©t t·ªïng quan (M·ªöI) -->
          <div class="pdf-comment">
            <h2>Nh·∫≠n x√©t t·ªïng quan</h2>
            <p id="report-comment-text"></p>
          </div>
        </div>

        <!-- C√°c n√∫t ƒëi·ªÅu h∆∞·ªõng (N·∫±m ngo√†i v√πng PDF) -->
        <div class="nav-btn-group">
          <button type="button" onclick="startOver()">‚¨ÖÔ∏è L√†m l·∫°i t·ª´ ƒë·∫ßu</button>
          <div>
            </button>
            <button type="button" onclick="downloadExcel()">
              üìä T·∫£i file Excel
            </button>
          </div>
        </div>
      </div>
    </form>

    <!-- Modal Structure -->
    <div class="modal-overlay" id="rubricModal" onclick="closeModal()">
      <div class="modal-content" onclick="event.stopPropagation()">
        <span class="modal-close" onclick="closeModal()">&times;</span>
        <h2 id="modal-title">Chi ti·∫øt Rubric</h2>
        <ul id="modal-list">
          <!-- N·ªôi dung s·∫Ω ƒë∆∞·ª£c ch√®n b·∫±ng JavaScript -->
        </ul>
      </div>
    </div>

    <script>
      let chart;
      let currentStep = 0; // B∆∞·ªõc hi·ªán t·∫°i c·ªßa wizard
      const totalSteps = 15; // 14 skills + 1 comment = 15 b∆∞·ªõc sau info
      const wizardSteps = document.querySelectorAll(".wizard-step");
      const progressBar = document.getElementById("progress-bar");
      const progressBarContainer = document.getElementById(
        "progress-bar-container"
      );
      const infoSection = document.getElementById("info-section");
      const wizardContainer = document.getElementById("wizard-container");
      const resultsSection = document.getElementById("results-section");

      // --- Labels (D√πng cho c·∫£ Chart v√† Excel) ---
      const skillLabels = [
        "L√†m vi·ªác nh√≥m",
        "Qu·∫£n l√Ω th·ªùi gian",
        "Tr√°ch nhi·ªám & h·ªó tr·ª£",
        "Gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ",
        "Giao ti·∫øp & th·∫•u hi·ªÉu",
        "·ª®ng ph√≥ kh·ªßng ho·∫£ng",
        "Gi·∫£i quy·∫øt xung ƒë·ªôt",
        "Vi·∫øt",
        "L·∫Øng nghe",
        "T·ª± h·ªçc",
        "Thuy·∫øt tr√¨nh",
        "T∆∞∆°ng t√°c nh√≥m Online",
        "Chuy√™n c·∫ßn",
        "L√£nh ƒë·∫°o",
      ];

      // --- D·ªØ li·ªáu Rubric (C·∫≠p nh·∫≠t 14 k·ªπ nƒÉng 0-3) ---
      const rubricCriteria = {
        1: {
          // L√†m vi·ªác nh√≥m
          0: "<strong>0 ƒëi·ªÉm (Normally):</strong> Kh√¥ng quan t√¢m ƒë·∫øn c√¥ng vi·ªác c·ªßa nh√≥m, kh√¥ng t∆∞∆°ng t√°c v·ªõi nh√≥m, kh√¥ng th·ª±c hi·ªán nhi·ªám v·ª• ƒë∆∞·ª£c ph√¢n c√¥ng.",
          1: "<strong>1 ƒëi·ªÉm (Limited):</strong> Hi·ªÉu ƒë∆∞·ª£c cam k·∫øt c·ªßa nh√≥m nh∆∞ng th·ª±c hi·ªán nhi·ªám v·ª• ƒë∆∞·ª£c ph√¢n c√¥ng ƒë·∫°t k·∫øt qu·∫£ th·∫•p.",
          2: "<strong>2 ƒëi·ªÉm (Developing):</strong> Tu√¢n th·ªß, gi√°m s√°t cam k·∫øt chung c·ªßa nh√≥m v√† t√≠ch c·ª±c th·ª±c hi·ªán nhi·ªámV·ª• ƒë∆∞·ª£c ph√¢n c√¥ng.",
          3: "<strong>3 ƒëi·ªÉm (Proficient):</strong> T√≠ch c·ª±c v√† ch·ªß ƒë·ªông h·ªó tr·ª£ nh√≥m x√°c ƒë·ªãnh m·ª•c ti√™u nh√≥m, t√≠ch c·ª±c tham gia c√°c ho·∫°t ƒë·ªông ƒë·ªÉ ƒë·∫°t ƒë∆∞·ª£c m·ª•c ti√™u.",
        },
        2: {
          // Qu·∫£n l√Ω th·ªùi gian (Planning)
          0: "<strong>0 ƒëi·ªÉm (Normally):</strong> Kh√¥ng bi·∫øt s·∫Øp x·∫øp th·ªùi gian ho√†n th√†nh c√¥ng vi·ªác ƒë∆∞·ª£c giao.",
          1: "<strong>1 ƒëi·ªÉm (Limited):</strong> Bi·∫øt s·∫Øp x·∫øp th·ªùi gian ho√†n th√†nh c√¥ng vi·ªác ƒë∆∞·ª£c giao, nh∆∞ng th·ª• ƒë·ªông.",
          2: "<strong>2 ƒëi·ªÉm (Developing):</strong> Bi·∫øt s·∫Øp x·∫øp th·ªùi gian ho√†n th√†nh c√¥ng vi·ªác ƒë∆∞·ª£c giao nh∆∞ng ch∆∞a t·ªëi ∆∞u ƒë∆∞·ª£c c√°c ƒë·∫ßu vi·ªác, thi·∫øu s·ª± linh ho·∫°t, ki·ªÉm so√°t r·ªßi ro k√©m.",
          3: "<strong>3 ƒëi·ªÉm (Proficient):</strong> Ch·ªß ƒë·ªông x√¢y d·ª±ng k·∫ø ho·∫°ch cho c√° nh√¢n, t·ªëi ∆∞u ƒë∆∞·ª£c c√°c h·∫°ng m·ª•c c·∫ßn ho√†n th√†nh, c√≥ ki·ªÉm so√°t r·ªßi ro.",
        },
        3: {
          // Tr√°ch nhi·ªám & h·ªó tr·ª£ (Project Management)
          0: "<strong>0 ƒëi·ªÉm (Normally):</strong> Kh√¥ng tu√¢n th·ªß quy ƒë·ªãnh c·ªßa th√†nh vi√™n trong d·ª± √°n.",
          1: "<strong>1 ƒëi·ªÉm (Limited):</strong> B·∫£o ƒë·∫£m c√¥ng vi·ªác ƒë∆∞·ª£c giao trong d·ª± √°n.",
          2: "<strong>2 ƒëi·ªÉm (Developing):</strong> Ho√†n th√†nh c√¥ng vi·ªác ƒë∆∞·ª£c giao v√† gi√∫p ƒë·ª° c√°c th√†nh vi√™n kh√°c.",
          3: "<strong>3 ƒëi·ªÉm (Proficient):</strong> Ho√†n th√†nh s·ªõm c√¥ng vi·ªác ƒë∆∞·ª£c giao, gi√∫p ƒë·ª° c√°c th√†nh vi√™n kh√°c, bi·∫øt ph√¢n b·ªï / ƒëi·ªÅu ph·ªëi c√°c ngu·ªìn l·ª±c, ch·ªß ƒë·ªông x·ª≠ l√Ω c√°c v·∫•n ƒë·ªÅ ph√°t sinh, ch·ªß ƒë·ªông b√°o c√°o ti·∫øn ƒë·ªô.",
        },
        4: {
          // Gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ (Problem Solving)
          0: "<strong>0 ƒëi·ªÉm (Normally):</strong> Kh√¥ng bi·∫øt c√°ch ph√¢n t√≠ch ƒë√°nh gi√° ƒë·ªÉ t√¨m c√°c nguy√™n nh√¢n c·ªßa v·∫•n ƒë·ªÅ.",
          1: "<strong>1 ƒëi·ªÉm (Limited):</strong> Bi·∫øt c√°ch ƒë√°nh gi√°, ph√¢n t√≠ch, t√¨m ra nguy√™n nh√¢n c·ªßa v·∫•n ƒë·ªÅ, nh∆∞ng kh√¥ng bi·∫øt ch·ªçn l·ªùi gi·∫£i h·ª£p l√Ω.",
          2: "<strong>2 ƒëi·ªÉm (Developing):</strong> Bi·∫øt c√°ch ƒë√°nh gi√°, ph√¢n t√≠ch, t√¨m ra nguy√™n nh√¢n c·ªßa v·∫•n ƒë·ªÅ, bi·∫øt x√°c ƒë·ªãnh c√°c ƒë·ªëi t∆∞∆°ng li√™n quan, c√≥ ƒë·ªÅ xu·∫•t ra ph∆∞∆°ng √°n gi·∫£i quy·∫øt nh∆∞ng ch∆∞a t·ªëi ∆∞u.",
          3: "<strong>3 ƒëi·ªÉm (Proficient):</strong> Nh·∫°y b√©n ph√°t hi·ªán v·∫•n ƒë·ªÅ, nguy√™n nh√¢n, c√°c ƒë·ªëi t∆∞·ª£ng li√™n quan, l·∫≠p lu·∫≠n logic ƒë∆∞a ra c√°c l·ªùi gi·∫£i, ƒë√°nh gi√° b√†i gi·∫£i ƒë·ªÉ ch·ªçn l·ªùi gi·∫£i h·ª£p l√Ω, tri·ªÉn khai ƒë∆∞·ª£c c√°c gi·∫£i ph√°p ƒë·ªÉ gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ hi·ªáu qu·∫£.",
        },
        5: {
          // Giao ti·∫øp & th·∫•u hi·ªÉu (Interpersonal)
          0: "<strong>0 ƒëi·ªÉm (Normally):</strong> Ch∆∞a hi·ªÉu v√† bi·∫øt c√°ch h∆∞·ªõng h√†nh vi c·ªßa b·∫£n th√¢n v√†o ƒë·ªëi t∆∞·ª£ng giao ti·∫øp... kh√¥ng bi·∫øt ki·ªÉm so√°t c·∫£m x√∫c c√° nh√¢n.",
          1: "<strong>1 ƒëi·ªÉm (Limited):</strong> Bi·∫øt h∆∞·ªõng h√†nh vi c·ªßa b·∫£n th√¢n theo ƒë·ªëi t∆∞·ª£ng giao ti·∫øp, b∆∞·ªõc ƒë·∫ßu bi·∫øt ƒë·∫∑t b·∫£n th√¢n v√†o v·ªã tr√≠ c·ªßa ƒë·ªëi t∆∞·ª£ng giao ti·∫øp, h√†nh vi ·ª©ng x·ª≠ c√≤n ch∆∞a ph√π h·ª£p.",
          2: "<strong>2 ƒëi·ªÉm (Developing):</strong> Hi·ªÉu v√† bi·∫øt c√°c h∆∞·ªõng h√†nh vi theo m·ª•c ti√™u nhi·ªám v·ª•, c√≥ h√†nh vi ·ª©ng x·ª≠ khoa h·ªçc, ph√π h·ª£p v·ªõi nhu c·∫ßu, nguy·ªán v·ªçng c·ªßa ƒë·ªëi t∆∞·ª£ng giao ti·∫øp nh∆∞ng ch∆∞a th∆∞·ªùng xuy√™n.",
          3: "<strong>3 ƒëi·ªÉm (Proficient):</strong> Th∆∞·ªùng xuy√™n th·∫•u hi·ªÉu ƒë·ªëi t∆∞·ª£ng giao ti·∫øp, bi·∫øt c√°ch h∆∞·ªõng h√†nh vi theo ƒë·ªëi t∆∞·ª£ng giao ti·∫øp, ·ª©ng x·ª≠ khoa h·ªçc ph√π h·ª£p, lu√¥n th·∫•u c·∫£m v·ªõi ƒë·ªëi t∆∞·ª£ng giao ti·∫øp.",
        },
        6: {
          // ·ª®ng ph√≥ kh·ªßng ho·∫£ng (Crisis Solving)
          0: "<strong>0 ƒëi·ªÉm (Normally):</strong> Kh√¥ng x√°c ƒë·ªãnh nguy√™n nh√¢n d·∫´n ƒë·∫øn kh·ªßng ho·∫£ng, ch∆∞a c√≥ kh·∫£ nƒÉng ƒë·ªëi di·ªán v·ªõi kh·ªßng ho·∫£ng, kh√¥ng ch·ªãu ƒë·ª±ng ƒë∆∞·ª£c √°p l·ª±c.",
          1: "<strong>1 ƒëi·ªÉm (Limited):</strong> X√°c ƒë·ªãnh nguy√™n nh√¢n d·∫´n ƒë·∫øn kh·ªßng ho·∫£ng nh∆∞ng ch∆∞a ƒë·∫ßy ƒë·ªß, ch∆∞a x√°c ƒë·ªãnh ƒë∆∞·ª£c m·ª©c ƒë·ªô kh·ªßng ho·∫£ng, ch∆∞a ƒë·ªß b√¨nh tƒ©nh ƒë·ªëi di·ªán... kh·∫£ nƒÉng ch·ªãu √°p l·ª±c k√©m.",
          2: "<strong>2 ƒëi·ªÉm (Developing):</strong> X√°c ƒë·ªãnh ch√≠nh x√°c nguy√™n nh√¢n d·∫´n ƒë·∫øn kh·ªßng ho·∫£ng, nh∆∞ng ch∆∞a x√°c ƒë·ªãnh ƒë∆∞·ª£c m·ª©c ƒë·ªô... c√≥ b√¨nh tƒ©nh ƒë·ªëi di·ªán... ch·ªãu ƒë·ª±ng ƒë∆∞·ª£c √°p l·ª±c... x√°c ƒë·ªãnh ƒë∆∞·ª£c ƒë·ªông l·ª±c v√† bi·ªán ph√°p... nh∆∞ng kh√¥ng th∆∞·ªùng xuy√™n.", // <-- ƒê√É S·ª¨A L·ªñI 2S
          3: "<strong>3 ƒëi·ªÉm (Proficient):</strong> X√°c ƒë·ªãnh ch√≠nh x√°c nguy√™n nh√¢n d·∫´n ƒë·∫øn kh·ªßng ho·∫£ng, m·ª©c ƒë·ªô kh·ªßng ho·∫£ng, ch·ªß ƒë·ªông / b√¨nh tƒ©nh ƒë·ªëi di·ªán... x√°c ƒë·ªãnh ƒë∆∞·ª£c ƒë·ªông l·ª±c v√† bi·ªán ph√°p cho b·∫£n th√¢n v∆∞·ª£t qua kh·ªßng ho·∫£ng.",
        },
        7: {
          // Gi·∫£i quy·∫øt xung ƒë·ªôt (Conflict Resolution)
          0: "<strong>0 ƒëi·ªÉm (Normally):</strong> Quan t√¢m nh∆∞ng ch∆∞a x√°c ƒë·ªãnh ƒë∆∞·ª£c ch√≠nh x√°c nguy√™n nh√¢n, kh√¥ng c√≥ kh·∫£ nƒÉng chia s·∫ª √Ω ki·∫øn, kh√¥ng c√≥ kh·∫£ nƒÉng ph·ªëi h·ª£p gi·∫£i quy·∫øt.",
          1: "<strong>1 ƒëi·ªÉm (Limited):</strong> X√°c ƒë·ªãnh ƒë∆∞·ª£c nguy√™n nh√¢n nh∆∞ng ch∆∞a ƒë·∫ßy ƒë·ªß, c√≥ kh·∫£ nƒÉng chia s·∫ª √Ω ki·∫øn nh∆∞ng ch∆∞a hi·ªáu qu·∫£, ch∆∞a ch·ªß ƒë·ªông ph·ªëi h·ª£p.",
          2: "<strong>2 ƒëi·ªÉm (Developing):</strong> X√°c ƒë·ªãnh ƒë∆∞·ª£c ch√≠nh x√°c nguy√™n nh√¢n, chia s·∫ª quan ƒëi·ªÉm ƒë√∫ng ƒë·∫Øn nh∆∞ng ch∆∞a th∆∞·ªùng xuy√™n, ch·ªß ƒë·ªông ph·ªëi h·ª£p nh∆∞ng ch∆∞a th∆∞·ªùng xuy√™n.",
          3: "<strong>3 ƒëi·ªÉm (Proficient):</strong> Th∆∞·ªùng xuy√™n x√°c ƒë·ªãnh ch√≠nh x√°c nguy√™n nh√¢n, m·ª©c ƒë·ªô xung ƒë·ªôt, chia s·∫ª quan ƒëi·ªÉm ƒë√∫ng ƒë·∫Øn, ch·ªß ƒë·ªông ph·ªëi h·ª£p hi·ªáu qu·∫£.",
        },
        8: {
          // Vi·∫øt (Writing)
          0: "<strong>0 ƒëi·ªÉm (Normally):</strong> Trao ƒë·ªïi (email, chat) k√©m, g√¢y hi·ªÉu l·∫ßm.",
          1: "<strong>1 ƒëi·ªÉm (Limited):</strong> Trao ƒë·ªïi t∆∞∆°ng ƒë·ªëi, ƒë√¥i khi c√≤n t·ªëi nghƒ©a, c·∫ßn ch·ªânh s·ª≠a.",
          2: "<strong>2 ƒëi·ªÉm (Developing):</strong> VƒÉn b·∫£n r√µ r√†ng, email/chat d·ªÖ hi·ªÉu.",
          3: "<strong>3 ƒëi·ªÉm (Proficient):</strong> VƒÉn b·∫£n chuy√™n nghi·ªáp, thuy·∫øt ph·ª•c, s√∫c t√≠ch.",
        },
        9: {
          // L·∫Øng nghe (Listening)
          0: "<strong>0 ƒëi·ªÉm (Normally):</strong> Kh√¥ng bi·∫øt l·∫Øng nghe.",
          1: "<strong>1 ƒëi·ªÉm (Limited):</strong> Bi·∫øt l·∫Øng nghe nh∆∞ng kh√¥ng bi·∫øt c√°ch tr√¨nh b√†y, thi·∫øu ch·ªß ƒë·ªông/t√≠ch c·ª±c, thi·∫øu ph·∫£n h·ªìi.",
          2: "<strong>2 ƒëi·ªÉm (Developing):</strong> Bi·∫øt l·∫Øng nghe th·∫•u hi·ªÉu v√† ch·ªß ƒë·ªông, bi·∫øt tr√¨nh b√†y, bi·∫øt d√πng ng√¥n ng·ªØ c∆° th·ªÉ, bi·∫øt ƒë·∫∑t c√¢u h·ªèi... nh∆∞ng kh√¥ng th∆∞·ªùng xuy√™n.",
          3: "<strong>3 ƒëi·ªÉm (Proficient):</strong> Bi·∫øt l·∫Øng nghe th·∫•u hi·ªÉu v√† ch·ªß ƒë·ªông, bi·∫øt tr√¨nh b√†y, s·ª≠ d·ª•ng ng√¥n ng·ªØ c∆° th·ªÉ, ƒë·∫∑t c√¢u h·ªèi g·ª£i m·ªü, ch·ªß ƒë·ªông t√≥m l∆∞·ª£c/t·ªïng h·ª£p n·ªôi dung.",
        },
        10: {
          // T·ª± h·ªçc (Learning)
          0: "<strong>0 ƒëi·ªÉm (Normally):</strong> Kh√¥ng c√≥ kh·∫£ nƒÉng t·ª± h·ªçc.",
          1: "<strong>1 ƒëi·ªÉm (Limited):</strong> C√≥ kh·∫£ nƒÉng t·ª± h·ªçc v·ªõi s·ª± gi√∫p ƒë·ª° (Mentor, Assistant), nh∆∞ng ch∆∞a ch·ªß ƒë·ªông, ch∆∞a bi·∫øt x√¢y d·ª±ng k·∫ø ho·∫°ch.",
          2: "<strong>2 ƒëi·ªÉm (Developing):</strong> C√≥ kh·∫£ nƒÉng t·ª± h·ªçc ch·ªß ƒë·ªông, bi·∫øt x√¢y d·ª±ng k·∫ø ho·∫°ch, bi·∫øt s·ª≠ d·ª•ng ph∆∞∆°ng ph√°p t·ª± h·ªçc... nh∆∞ng ch∆∞a hi·ªáu qu·∫£.",
          3: "<strong>3 ƒëi·ªÉm (Proficient):</strong> Ch·ªß ƒë·ªông x√¢y d·ª±ng k·∫ø ho·∫°ch (m·ª•c ti√™u, k·∫ø ho·∫°ch, th·ª±c hi·ªán), s·ª≠ d·ª•ng th√†nh th·∫°o ph∆∞∆°ng ph√°p t·ª± h·ªçc, ch·ªß ƒë·ªông gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ, bi·∫øt t·ª± ki·ªÉm tra v√† ƒë√°nh gi√° k·∫øt qu·∫£.",
        },
        11: {
          // Thuy·∫øt tr√¨nh (Presentation)
          0: "<strong>0 ƒëi·ªÉm:</strong> Tr√¨nh b√†y kh√¥ng r√µ r√†ng, kh√¥ng logic, kh√¥ng thu h√∫t.",
          1: "<strong>1 ƒëi·ªÉm:</strong> Tr√¨nh b√†y ·ªü m·ª©c c∆° b·∫£n, c√≥ n·ªôi dung nh∆∞ng ch∆∞a logic, ch∆∞a t·ªët v·ªÅ h√¨nh th·ª©c.",
          2: "<strong>2 ƒëi·ªÉm:</strong> Tr√¨nh b√†y r√µ r√†ng, logic, h√¨nh th·ª©c ·ªïn.",
          3: "<strong>3 ƒëi·ªÉm:</strong> S·ª≠ d·ª•ng s√°ng t·∫°o c√°c c√¥ng c·ª• thuy·∫øt tr√¨nh, thi·∫øt k·∫ø s√°ng t·∫°o h√¨nh th·ª©c & n·ªôi dung tr√¨nh b√†y.",
        },
        12: {
          // T∆∞∆°ng t√°c nh√≥m Online (Group Online)
          0: "<strong>0 ƒëi·ªÉm (Normally):</strong> Kh√¥ng tham gia th·∫£o lu·∫≠n tr√™n Group Online.",
          1: "<strong>1 ƒëi·ªÉm (Limited):</strong> C√≥ tham gia Group Online t·ª´ 1-2 l·∫ßn/tu·∫ßn, c√≥ tham gia, kh√¥ng ho·∫∑c √≠t ƒë√≥ng g√≥p √Ω ki·∫øn, √≠t comment.",
          2: "<strong>2 ƒëi·ªÉm (Developing):</strong> C√≥ tham gia Group Online tr√™n 2 l·∫ßn/tu·∫ßn. Tham gia th∆∞·ªùng xuy√™n, c√≤n th·ª• ƒë·ªông trong vi·ªác ƒë·ªÅ xu·∫•t √Ω ki·∫øn.",
          3: "<strong>3 ƒëi·ªÉm (Proficient):</strong> C√≥ tham gia Group Online tr√™n 2 l·∫ßn/tu·∫ßn. Tham gia th∆∞·ªùng xuy√™n, ch·ªß ƒë·ªông ƒë·ªÅ xu·∫•t ƒë√≥ng g√≥p nhi·ªÅu √Ω ki·∫øn cho group.",
        },
        13: {
          // Chuy√™n c·∫ßn (Attendance)
          0: "<strong>0 ƒëi·ªÉm:</strong> Th∆∞·ªùng xuy√™n v·∫Øng, tr·ªÖ kh√¥ng l√Ω do.",
          1: "<strong>1 ƒëi·ªÉm:</strong> C√≥ v·∫Øng/tr·ªÖ nh∆∞ng c√≥ b√°o tr∆∞·ªõc, ƒë√¥i khi ·∫£nh h∆∞·ªüng chung.",
          2: "<strong>2 ƒëi·ªÉm:</strong> Lu√¥n tham gia ƒë·∫ßy ƒë·ªß, ƒë√∫ng gi·ªù.",
          3: "<strong>3 ƒëi·ªÉm:</strong> Lu√¥n tham gia ƒë·∫ßy ƒë·ªß, ƒë√∫ng gi·ªù, chu·∫©n b·ªã k·ªπ n·ªôi dung cho c√°c bu·ªïi h·ªçp.",
        },
        14: {
          // L√£nh ƒë·∫°o (Leadership)
          0: "<strong>0 ƒëi·ªÉm (Normally):</strong> Ho√†n th√†nh c√¥ng vi·ªác c·ªßa m·ªôt member. Kh√¥ng l√†m t·ªët vai tr√≤ c·ªßa leader.",
          1: "<strong>1 ƒëi·ªÉm (Limited):</strong> M√¥ t·∫£ ƒë∆∞·ª£c t∆∞∆°ng ƒë·ªëi c√°c m·ª•c ti√™u v√† ƒë·ªãnh h∆∞·ªõng, thi·∫øt l·∫≠p t∆∞∆°ng ƒë·ªëi k·∫ø ho·∫°ch, truy·ªÅn ƒë·∫°t ƒë∆∞·ª£c c∆° b·∫£n n·ªôi dung.",
          2: "<strong>2 ƒëi·ªÉm (Developing):</strong> M√¥ t·∫£ ƒë∆∞·ª£c ch√≠nh x√°c m·ª•c ti√™u v√† ƒë·ªãnh h∆∞·ªõng, thi·∫øt l·∫≠p t∆∞∆°ng ƒë·ªëi k·∫ø ho·∫°ch, truy·ªÅn ƒë·∫°t c∆° b·∫£n, g·∫Øn k·∫øt ƒë∆∞·ª£c ƒë·ªôi ng≈©, gi√°m s√°t v√† th√∫c ƒë·∫©y, c√≥ h·ªó tr·ª£.",
          3: "<strong>3 ƒëi·ªÉm (Proficient):</strong> M√¥ t·∫£ ch√≠nh x√°c, ƒë·∫ßy ƒë·ªß m·ª•c ti√™u v√† ƒë·ªãnh h∆∞·ªõng, thi·∫øt l·∫≠p k·∫ø ho·∫°ch m·∫°ch l·∫°c, bi·∫øt ∆∞u ti√™n c√°c nhi·ªám v·ª•, g·∫Øn k·∫øt t·ªët ƒë·ªôi ng≈©, gi√°m s√°t - ki·ªÉm tra - th√∫c ƒë·∫©y li√™n t·ª•c, d·ª± b√°o ƒë∆∞·ª£c v·∫•n ƒë·ªÅ.",
        },
      };

      // --- Theme Changing (M·ªöI) ---
      const colorThemes = {
        1: "theme-1",
        2: "theme-2",
        3: "theme-3",
        4: "theme-4",
        5: "theme-5",
      };

      document
        .getElementById("member-select")
        .addEventListener("change", function () {
          const selectedTheme = colorThemes[this.value] || "theme-1";
          document.body.className = ""; // X√≥a h·∫øt theme c≈©
          document.body.classList.add(selectedTheme);

          // C·∫≠p nh·∫≠t m√†u s·∫Øc cho PDF content (ƒë·ªÉ ƒë·ªìng b·ªô)
          const pdfContent = document.getElementById("report-content");
          const style = getComputedStyle(document.body);
          pdfContent.style.setProperty(
            "--color-primary",
            style.getPropertyValue("--color-primary")
          );
          pdfContent.style.setProperty(
            "--color-primary-hover",
            style.getPropertyValue("--color-primary-hover")
          );
          pdfContent.style.setProperty(
            "--color-accent",
            style.getPropertyValue("--color-accent")
          );
          pdfContent.style.setProperty(
            "--color-bg-light",
            style.getPropertyValue("--color-bg-light")
          );
          pdfContent.style.setProperty(
            "--color-bg-dark",
            style.getPropertyValue("--color-bg-dark")
          );
        });

      // --- Modal Functions ---
      function showModal(skillId, skillTitle) {
        const criteria = rubricCriteria[skillId];
        document.getElementById("modal-title").innerText = skillTitle;
        const listElement = document.getElementById("modal-list");
        listElement.innerHTML = "";
        if (criteria) {
          // S·ª≠a l·ªói g√µ sai trong d·ªØ li·ªáu (v√≠ d·ª•: '3G ƒëi·ªÉm' -> '3 ƒëi·ªÉm')
          for (const key in criteria) {
            const li = document.createElement("li");
            li.innerHTML = criteria[key].replace(/(\d+)[A-Z](\s*ƒëi·ªÉm)/, "$1$2"); // X√≥a ch·ªØ c√°i l·∫°
            listElement.appendChild(li);
          }
        } else {
          listElement.innerHTML =
            "<li>Ch∆∞a c√≥ m√¥ t·∫£ chi ti·∫øt cho k·ªπ nƒÉng n√†y.</li>";
        }
        document.getElementById("rubricModal").style.display = "flex";
      }

      function closeModal() {
        document.getElementById("rubricModal").style.display = "none";
      }

      // S·ª¨A L·ªñI 3: Logic ·∫©n/hi·ªán trang m·ªõi

      // --- (NEW) Page Navigation ---
      function showPage(pageId) {
        // ·∫®n t·∫•t c·∫£ c√°c trang ch√≠nh
        infoSection.style.display = "none";
        wizardContainer.style.display = "none";
        resultsSection.style.display = "none";

        // ·∫®n thanh ti·∫øn tr√¨nh m·∫∑c ƒë·ªãnh
        progressBarContainer.style.display = "none";

        if (pageId === "info") {
          infoSection.style.display = "block";
        } else if (pageId === "wizard") {
          wizardContainer.style.display = "block";
          progressBarContainer.style.display = "block"; // Ch·ªâ hi·ªán thanh ti·∫øn tr√¨nh ·ªü wizard
        } else if (pageId === "results") {
          resultsSection.style.display = "block";
        }
      }

      // --- Wizard Navigation (ƒê√£ c·∫≠p nh·∫≠t) ---
      function showStep(stepIndex) {
        wizardSteps.forEach((step, index) => {
          // step.dataset.step l·∫•y gi√° tr·ªã t·ª´ data-step="X"
          if (parseInt(step.dataset.step) === stepIndex) {
            step.classList.add("active");
          } else {
            step.classList.remove("active");
          }
        });
        // C·∫≠p nh·∫≠t progress bar
        if (stepIndex > 0) {
          let progress = (stepIndex / totalSteps) * 100;
          progressBar.style.width = progress + "%";
          progressBar.innerText = `Ho√†n th√†nh ${Math.round(progress)}%`;
        }
      }

      function nextStep(stepIndex) {
        if (validateStep(stepIndex)) {
          currentStep++;
          if (currentStep === 1) {
            // B·∫Øt ƒë·∫ßu t·ª´ b∆∞·ªõc 1
            showPage("wizard"); // Logic m·ªõi: Hi·ªÉn th·ªã trang wizard
          }
          showStep(currentStep);
        }
      }

      function prevStep() {
        currentStep--;
        if (currentStep === 0) {
          // Quay v·ªÅ b∆∞·ªõc th√¥ng tin
          showPage("info"); // Logic m·ªõi: Hi·ªÉn th·ªã trang info
        }
        showStep(currentStep);
      }

      // --- (H√ÄM ƒê√É C·∫¨P NH·∫¨T) ---
      function finishForm() {
        if (validateStep(15)) {
          // Validate b∆∞·ªõc cu·ªëi (t·ªïng quan)
          showPage("results"); // Logic m·ªõi: Hi·ªÉn th·ªã trang k·∫øt qu·∫£

          // 1. T·∫°o bi·ªÉu ƒë·ªì
          generateChart();

          // 2. ƒêi·ªÅn th√¥ng tin b√°o c√°o
          const groupName = document.getElementById("groupName").value;
          const memberName =
            document.getElementById("member-select").options[
              document.getElementById("member-select").selectedIndex
            ].text;
          const weekStart = document.getElementById("week-start").value;
          const weekEnd = document.getElementById("week-end").value;
          const generalComment = document.getElementById("comment").value;

          document.getElementById("report-groupName").innerText = groupName;
          document.getElementById("report-name").innerText = memberName;
          document.getElementById(
            "report-week"
          ).innerText = `${weekStart} ƒë·∫øn ${weekEnd}`;
          document.getElementById("report-comment-text").innerText =
            generalComment;

          // 3. ƒêi·ªÅn b·∫£ng ƒëi·ªÉm
          populateReportTable();
        }
      }

      // --- (H√ÄM M·ªöI ƒê·ªÇ ƒêI·ªÄN B·∫¢NG) ---
      function populateReportTable() {
        const tbody = document.getElementById("report-table-body");
        tbody.innerHTML = ""; // X√≥a d·ªØ li·ªáu c≈©

        for (let i = 1; i <= 14; i++) {
          const skill = skillLabels[i - 1];
          const score = document.getElementById(`s${i}`).value;
          const comment = document.getElementById(`c${i}`).value;

          const row = `<tr>
                <td>${i}. ${skill}</td>
                <td>${score}</td>
                <td>${comment}</td>
            </tr>`;
          tbody.innerHTML += row;
        }
      }

      function startOver() {
        currentStep = 0;
        showPage("info"); // Logic m·ªõi: Hi·ªÉn th·ªã trang info
        showStep(0); // K√≠ch ho·∫°t l·∫°i b∆∞·ªõc 0
        if (chart) chart.destroy();
        // Kh√¥ng reset form, ƒë·ªÉ ng∆∞·ªùi d√πng c√≥ th·ªÉ s·ª≠a
      }

      // --- Validation Functions (ƒê√É S·ª¨A) ---
      function validateScore(input) {
        const value = parseFloat(input.value);
        // S·ª≠a: Ch·ªâ cho ph√©p S·ªê NGUY√äN t·ª´ 0-3
        if (
          input.value === "" ||
          value < 0 ||
          value > 3 ||
          !Number.isInteger(value)
        ) {
          input.classList.add("invalid");
          return false;
        } else {
          input.classList.remove("invalid");
          return true;
        }
      }

      function validateStep(stepIndex) {
        const stepElement = document.querySelector(
          `.wizard-step[data-step="${stepIndex}"]`
        );
        if (!stepElement) return true; // Step kh√¥ng t·ªìn t·∫°i

        const inputs = stepElement.querySelectorAll(
          "input[required], textarea[required], select[required]"
        );
        const errorMsg = document.getElementById(
          `error-message-step${stepIndex}`
        );
        let isValid = true;

        for (const input of inputs) {
          if (!input.value.trim()) {
            isValid = false;
          }
          if (input.type === "number") {
            if (!validateScore(input)) {
              // D√πng l·∫°i h√†m validateScore ƒë√£ s·ª≠a
              isValid = false;
            }
          }
        }

        if (errorMsg) {
          errorMsg.style.display = isValid ? "none" : "block";
        }

        return isValid;
      }

      // --- Chart Function (Theme-aware) ---
      function generateChart() {
        // L·∫•y m√†u t·ª´ CSS variables
        const style = getComputedStyle(document.body);
        const chartBorderColor =
          style.getPropertyValue("--color-secondary").trim() || "#0ea5e9";
        const chartBgColor =
          style.getPropertyValue("--color-accent-light").trim() ||
          "rgba(14, 165, 233, 0.3)";
        const pointLabelColor =
          style.getPropertyValue("--color-accent").trim() || "#0c4a6e";

        const labelsWithNumbers = skillLabels.map(
          (label, index) => `${index + 1}. ${label}`
        );
        const data = [];
        for (let i = 1; i <= 14; i++) {
          data.push(document.getElementById(`s${i}`).value);
        }

        let memberName =
          document.getElementById("member-select").options[
            document.getElementById("member-select").selectedIndex
          ].text;

        if (chart) chart.destroy();
        const ctx = document.getElementById("radarChart").getContext("2d");
        chart = new Chart(ctx, {
          type: "radar",
          data: {
            labels: labelsWithNumbers,
            datasets: [
              {
                label: `ƒêi·ªÉm t·ª± ƒë√°nh gi√° - ${memberName}`,
                data: data.map(Number),
                backgroundColor: chartBgColor,
                borderColor: chartBorderColor,
                borderWidth: 2,
                pointBackgroundColor: chartBorderColor,
                pointRadius: 4,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            // T·∫ÆT ANIMATION ƒê·ªÇ PDF HO·∫†T ƒê·ªòNG
            animation: {
              duration: 0,
            },
            scales: {
              r: {
                min: 0,
                max: 3,
                ticks: {
                  stepSize: 1,
                  backdropColor: "rgba(255, 255, 255, 0.75)",
                  color: "#444",
                  font: { weight: "bold" },
                },
                pointLabels: {
                  font: { size: 9, weight: "600" },
                  color: pointLabelColor,
                },
                grid: { color: "rgba(0, 0, 0, 0.1)" },
                angleLines: { color: "rgba(0, 0, 0, 0.1)" },
              },
            },
            plugins: {
              legend: { labels: { font: { size: 11, weight: "600" } } },
            },
          },
        });
      }

      // --- PDF Download Function (ƒê√É C·∫¨P NH·∫¨T ƒê·ªÇ S·ª¨A L·ªñI TRANG TR·∫ÆNG) ---
      async function downloadPDF() {
        const reportElement = document.getElementById("report-content"); // (M·ªöI)
        const buttons = document.querySelector(
          "#results-section .nav-btn-group"
        );
        const canvas = document.getElementById("radarChart");
        const chartImageElement = document.getElementById("pdf-chart-image");

        try {
          if (!chart) {
            console.error("Chart ch∆∞a ƒë∆∞·ª£c kh·ªüi t·∫°o.");
            return;
          }

          // L·∫•y th√¥ng tin member tr∆∞·ªõc
          const memberName =
            document.getElementById("member-select").options[
              document.getElementById("member-select").selectedIndex
            ].text;
          const weekStart = document.getElementById("week-start").value;

          // 1. L·∫•y ·∫£nh Base64 t·ª´ chart v·ªõi ƒë·ªô ph√¢n gi·∫£i cao
          // T·∫°o canvas ·∫©n v·ªõi ƒë·ªô ph√¢n gi·∫£i cao ƒë·ªÉ render chart
          const scaleFactor = 3;
          const tempCanvas = document.createElement('canvas');
          const tempCtx = tempCanvas.getContext('2d');
          
          // T√≠nh k√≠ch th∆∞·ªõc canvas v·ªõi ƒë·ªô ph√¢n gi·∫£i cao
          const rect = canvas.getBoundingClientRect();
          tempCanvas.width = rect.width * scaleFactor;
          tempCanvas.height = rect.height * scaleFactor;
          
          // T·∫°o chart t·∫°m v·ªõi ƒë·ªô ph√¢n gi·∫£i cao
          const style = getComputedStyle(document.body);
          const chartBorderColor = style.getPropertyValue("--color-secondary").trim() || "#0ea5e9";
          const chartBgColor = style.getPropertyValue("--color-accent-light").trim() || "rgba(14, 165, 233, 0.3)";
          const pointLabelColor = style.getPropertyValue("--color-accent").trim() || "#0c4a6e";
          
          const labelsWithNumbers = skillLabels.map((label, index) => `${index + 1}. ${label}`);
          const data = [];
          for (let i = 1; i <= 14; i++) {
            data.push(document.getElementById(`s${i}`).value);
          }
          
          const tempChart = new Chart(tempCtx, {
            type: "radar",
            data: {
              labels: labelsWithNumbers,
              datasets: [{
                label: `ƒêi·ªÉm t·ª± ƒë√°nh gi√° - ${memberName}`,
                data: data.map(Number),
                backgroundColor: chartBgColor,
                borderColor: chartBorderColor,
                borderWidth: 2 * scaleFactor,
                pointBackgroundColor: chartBorderColor,
                pointRadius: 4 * scaleFactor,
              }],
            },
            options: {
              responsive: false,
              maintainAspectRatio: false,
              animation: { duration: 0 },
              scales: {
                r: {
                  min: 0,
                  max: 3,
                  ticks: {
                    stepSize: 1,
                    backdropColor: "rgba(255, 255, 255, 0.75)",
                    color: "#444",
                    font: { weight: "bold", size: 10 * scaleFactor },
                  },
                  pointLabels: {
                    font: { size: 9 * scaleFactor, weight: "600" },
                    color: pointLabelColor,
                  },
                  grid: { color: "rgba(0, 0, 0, 0.1)" },
                  angleLines: { color: "rgba(0, 0, 0, 0.1)" },
                },
              },
              plugins: {
                legend: { labels: { font: { size: 11 * scaleFactor, weight: "600" } } },
              },
            },
          });
          
          // Ch·ªù chart render xong
          await new Promise((resolve) => setTimeout(resolve, 100));
          
          // L·∫•y ·∫£nh v·ªõi ƒë·ªô ph√¢n gi·∫£i cao t·ª´ chart t·∫°m
          const chartImage = tempChart.toBase64Image('image/png', 1.0);
          
          // H·ªßy chart t·∫°m
          tempChart.destroy();

          // 2. G√°n ·∫£nh v√†o th·∫ª <img> t·∫°m
          chartImageElement.src = chartImage;
          chartImageElement.style.display = "block";

          // 3. ·∫®n canvas g·ªëc
          canvas.style.display = "none";

          // 4. (ƒê√É X√ìA) G·ª° b·ªè logic class helper
          // document.body.classList.add('pdf-generating');

          // L·∫•y element l√† n·ªôi dung b√°o c√°o
          const element = document.getElementById("report-content");

          const opt = {
            margin: [0.4, 0.4, 0.4, 0.4], // L·ªÅ tr√™n, ph·∫£i, d∆∞·ªõi, tr√°i (inch) - gi·∫£m ƒë·ªÉ v·ª´a A4
            filename: `BaoCao_Rubric_${
              memberName.split(" ")[0]
            }_${weekStart}.pdf`,
            image: { type: "png", quality: 1.0 }, // D√πng PNG v·ªõi quality t·ªëi ƒëa
            html2canvas: { 
              scale: 3, // TƒÉng scale l√™n 3 ƒë·ªÉ c√≥ ƒë·ªô ph√¢n gi·∫£i cao
              useCORS: true, 
              logging: false,
              letterRendering: true, // T·ªëi ∆∞u render ch·ªØ
              allowTaint: false,
              backgroundColor: '#ffffff'
            },
            jsPDF: { unit: "in", format: "a4", orientation: "portrait" },
          };

          // Ch·ªù m·ªôt ch√∫t ƒë·ªÉ DOM c·∫≠p nh·∫≠t ·∫£nh v√† CSS
          await new Promise((resolve) => setTimeout(resolve, 200));

          // 5. Ch·ª•p PDF v·ªõi ·∫£nh tƒ©nh v√† CSS ƒë√£ t·ªëi ∆∞u
          html2pdf()
            .set(opt)
            .from(element)
            .save()
            .then(() => {
              // 6. Kh√¥i ph·ª•c l·∫°i tr·∫°ng th√°i ban ƒë·∫ßu
              // (ƒê√É X√ìA) G·ª° b·ªè logic class helper
              // document.body.classList.remove('pdf-generating');
              chartImageElement.style.display = "none";
              chartImageElement.src = "";
              canvas.style.display = "block";
            });
        } catch (e) {
          console.error("L·ªói khi t·∫°o PDF:", e);
          // Kh√¥i ph·ª•c l·∫°i tr·∫°ng th√°i n·∫øu c√≥ l·ªói
          // (ƒê√É X√ìA) G·ª° b·ªè logic class helper
          // document.body.classList.remove('pdf-generating');
          chartImageElement.style.display = "none";
          chartImageElement.src = "";
          canvas.style.display = "block";
        }
      }

      // --- Download Excel Function (M·ªöI) ---
      function downloadExcel() {
        const data = [
          ["K·ªπ nƒÉng", "ƒêi·ªÉm", "Nh·∫≠n x√©t"], // Header
        ];

        // L·∫•y d·ªØ li·ªáu
        for (let i = 1; i <= 14; i++) {
          const skillName = skillLabels[i - 1];
          const score = document.getElementById(`s${i}`).value;
          const comment = document.getElementById(`c${i}`).value;
          data.push([`${i}. ${skillName}`, Number(score), comment]);
        }

        // Th√™m nh·∫≠n x√©t t·ªïng quan
        data.push([
          "Nh·∫≠n x√©t t·ªïng quan",
          "",
          document.getElementById("comment").value,
        ]);

        // T·∫°o workbook v√† worksheet
        const ws = XLSX.utils.aoa_to_sheet(data);

        // ƒê·ªãnh d·∫°ng c·ªôt (v√≠ d·ª•: ƒë·ªô r·ªông)
        ws["!cols"] = [
          { wch: 30 }, // C·ªôt K·ªπ nƒÉng
          { wch: 10 }, // C·ªôt ƒêi·ªÉm
          { wch: 80 }, // C·ªôt Nh·∫≠n x√©t
        ];

        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "T·ª± ƒë√°nh gi√° Rubric");

        // L·∫•y th√¥ng tin t√™n file
        const memberName = document
          .getElementById("member-select")
          .options[
            document.getElementById("member-select").selectedIndex
          ].text.split(" ")[0];
        const weekStart = document.getElementById("week-start").value;

        // Xu·∫•t file
        XLSX.writeFile(wb, `Rubric_${memberName}_${weekStart}.xlsx`);
      }

      // Kh·ªüi t·∫°o wizard ·ªü b∆∞·ªõc 0 (ƒê√É C·∫¨P NH·∫¨T)
      document.addEventListener("DOMContentLoaded", () => {
        showPage("info"); // Logic m·ªõi: Lu√¥n b·∫Øt ƒë·∫ßu ·ªü trang info
        showStep(0); // K√≠ch ho·∫°t b∆∞·ªõc 0 (info-section)

        // ƒê·ªìng b·ªô theme cho report-content ngay t·ª´ ƒë·∫ßu
        const pdfContent = document.getElementById("report-content");
        const style = getComputedStyle(document.body);
        pdfContent.style.setProperty(
          "--color-primary",
          style.getPropertyValue("--color-primary")
        );
        pdfContent.style.setProperty(
          "--color-primary-hover",
          style.getPropertyValue("--color-primary-hover")
        );
        pdfContent.style.setProperty(
          "--color-accent",
          style.getPropertyValue("--color-accent")
        );
        pdfContent.style.setProperty(
          "--color-bg-light",
          style.getPropertyValue("--color-bg-light")
        );
        pdfContent.style.setProperty(
          "--color-bg-dark",
          style.getPropertyValue("--color-bg-dark")
        );
      });
    </script>
  </body>
</html>

